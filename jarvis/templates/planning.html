<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Life Mastery - 3-Month Strategic Plan</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script type="module" src="/static/js/firebase-init.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;500;600;700;800;900&display=swap" rel="stylesheet">
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        'cyber-blue': '#0066ff',
                        'cyber-red': '#ef4444',
                        'cyber-green': '#22c55e',
                        'cyber-purple': '#a855f7'
                    }
                }
            }
        }
    </script>
    <style>
        .text-glow {
            text-shadow: 
                0 0 5px #0066ff,
                0 0 10px #0066ff,
                0 0 20px #0066ff;
        }
        
        .bg-grid-pattern {
            background-image: 
                linear-gradient(rgba(255,255,255,0.1) 1px, transparent 1px),
                linear-gradient(90deg, rgba(255,255,255,0.1) 1px, transparent 1px);
            background-size: 20px 20px;
        }
        
        .plan-card {
            background: linear-gradient(135deg, rgba(0,0,0,0.8) 0%, rgba(20,20,20,0.9) 100%);
            border: 1px solid rgba(255,255,255,0.3);
            backdrop-filter: blur(10px);
            transition: all 0.3s ease;
        }
        
        .plan-card:hover {
            border-color: rgba(0,102,255,0.5);
            box-shadow: 0 0 20px rgba(0,102,255,0.3);
            transform: translateY(-2px);
        }
        
        .month-theme {
            background: linear-gradient(45deg, rgba(0,102,255,0.2), rgba(34,197,94,0.2));
            border-left: 4px solid #0066ff;
        }
        
        .week-progress {
            height: 8px;
            background: rgba(255,255,255,0.2);
            border-radius: 4px;
            overflow: hidden;
        }
        
        .week-progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #0066ff, #22c55e);
            border-radius: 4px;
            transition: width 0.3s ease;
        }
        
        .goal-item {
            background: rgba(255,255,255,0.05);
            border: 1px solid rgba(255,255,255,0.1);
            border-radius: 8px;
            padding: 12px;
            margin: 8px 0;
            transition: all 0.3s ease;
        }
        
        .goal-item:hover {
            background: rgba(255,255,255,0.1);
            border-color: rgba(0,102,255,0.3);
        }
        
        .difficulty-badge {
            display: inline-block;
            padding: 2px 8px;
            border-radius: 12px;
            font-size: 0.75rem;
            font-weight: bold;
        }
        
        .difficulty-E { background: #22c55e; color: black; }
        .difficulty-D { background: #3b82f6; color: white; }
        .difficulty-C { background: #f59e0b; color: black; }
        .difficulty-B { background: #ef4444; color: white; }
        .difficulty-A { background: #a855f7; color: white; }
        .difficulty-S { background: #ec4899; color: white; }
    </style>
</head>
<body class="bg-black text-white min-h-screen">
    <div class="container mx-auto p-4 md:p-8">
        <!-- Header -->
        <div class="text-center mb-8">
            <h1 class="text-4xl font-bold mb-4 text-glow font-orbitron">STRATEGIC LIFE MASTERY PLAN</h1>
            <div class="flex justify-center gap-8">
                <div class="plan-card rounded p-4">
                    <span class="text-white/60">Current Level</span>
                    <span class="text-2xl font-bold text-glow ml-2">{{ stats.level }}</span>
                </div>
                <div class="plan-card rounded p-4">
                    <span class="text-white/60">Rank</span>
                    <span class="text-2xl font-bold text-glow ml-2">{{ stats.rank }}</span>
                </div>
                <div class="plan-card rounded p-4">
                    <span class="text-white/60">Total XP</span>
                    <span class="text-2xl font-bold text-glow ml-2">{{ stats.experience }}</span>
                </div>
            </div>
        </div>

        <!-- Action Buttons -->
        <div class="flex justify-center gap-4 mb-8">
            <button onclick="generatePlan()" class="bg-cyber-blue text-white px-6 py-3 rounded-lg hover:bg-blue-600 transition-all duration-300 font-bold">
                🎯 Generate New Plan
            </button>
            <button onclick="generateDailyQuests()" class="bg-cyber-green text-white px-6 py-3 rounded-lg hover:bg-green-600 transition-all duration-300 font-bold">
                📋 Generate Daily Quests
            </button>
            <button onclick="sendTestNotification()" class="bg-cyber-purple text-white px-6 py-3 rounded-lg hover:bg-purple-600 transition-all duration-300 font-bold">
                🔔 Test Notification
            </button>
        </div>

        {% if plan %}
        <!-- Plan Overview -->
        <div class="plan-card rounded-lg p-6 mb-8">
            <h2 class="text-2xl font-bold mb-4 text-cyber-blue">📅 Plan Overview</h2>
            <div class="grid md:grid-cols-3 gap-4">
                <div class="text-center">
                    <div class="text-3xl font-bold text-cyber-green">{{ plan.total_weeks }}</div>
                    <div class="text-white/60">Total Weeks</div>
                </div>
                <div class="text-center">
                    <div class="text-3xl font-bold text-cyber-blue">{{ plan.months|length }}</div>
                    <div class="text-white/60">Months</div>
                </div>
                <div class="text-center">
                    <div class="text-3xl font-bold text-cyber-purple">{{ current_date[:10] }}</div>
                    <div class="text-white/60">Started</div>
                </div>
            </div>
        </div>

        <!-- Monthly Breakdown -->
        {% for month_name, month_data in plan.months.items() %}
        <div class="plan-card rounded-lg p-6 mb-8">
            <div class="month-theme rounded-lg p-4 mb-6">
                <h2 class="text-2xl font-bold mb-2">{{ month_name }}: {{ month_data.theme }}</h2>
                <div class="flex flex-wrap gap-2">
                    {% for area in month_data.focus_areas %}
                    <span class="px-3 py-1 bg-cyber-blue/30 rounded-full text-sm">{{ area.replace('_', ' ').title() }}</span>
                    {% endfor %}
                </div>
            </div>

            <!-- Weekly Breakdown -->
            <div class="grid md:grid-cols-2 gap-6">
                {% for week_name, week_data in month_data.weeks.items() %}
                <div class="goal-item">
                    <div class="flex justify-between items-center mb-3">
                        <h3 class="text-lg font-bold text-cyber-green">{{ week_name }}</h3>
                        <span class="text-sm text-white/60">Week {{ week_data.week_number }}</span>
                    </div>
                    
                    <!-- Progress Bar -->
                    <div class="week-progress mb-3">
                        <div class="week-progress-fill" style="width: 30%"></div>
                    </div>
                    
                    <!-- Goals -->
                    <div class="space-y-2">
                        {% for goal in week_data.goals %}
                        <div class="flex justify-between items-center p-2 bg-black/30 rounded">
                            <span class="text-sm">{{ goal.name }}</span>
                            <span class="difficulty-badge difficulty-{{ goal.difficulty }}">{{ goal.difficulty }}</span>
                        </div>
                        {% endfor %}
                    </div>
                    
                    <!-- Daily Focus -->
                    <div class="mt-3 pt-3 border-t border-white/20">
                        <div class="text-xs text-white/60 mb-1">Daily Quest Focus:</div>
                        <div class="flex flex-wrap gap-1">
                            {% for focus in week_data.daily_quest_focus %}
                            <span class="px-2 py-1 bg-cyber-purple/30 rounded text-xs">{{ focus.title() }}</span>
                            {% endfor %}
                        </div>
                    </div>
                </div>
                {% endfor %}
            </div>
        </div>
        {% endfor %}

        {% else %}
        <!-- No Plan Available -->
        <div class="plan-card rounded-lg p-12 text-center">
            <div class="text-6xl mb-4">🎯</div>
            <h2 class="text-2xl font-bold mb-4 text-cyber-blue">No Strategic Plan Found</h2>
            <p class="text-white/70 mb-6">Generate your personalized 3-month plan to start your journey to mastery.</p>
            <button onclick="generatePlan()" class="bg-cyber-blue text-white px-8 py-4 rounded-lg hover:bg-blue-600 transition-all duration-300 font-bold text-lg">
                🚀 Create Your Plan
            </button>
        </div>
        {% endif %}

        <!-- Quick Stats Dashboard -->
        <div class="grid md:grid-cols-4 gap-4 mt-8">
            <div class="plan-card rounded-lg p-4 text-center">
                <div class="text-2xl font-bold text-cyber-blue" id="dailyQuests">-</div>
                <div class="text-white/60 text-sm">Daily Quests</div>
            </div>
            <div class="plan-card rounded-lg p-4 text-center">
                <div class="text-2xl font-bold text-cyber-green" id="completedToday">-</div>
                <div class="text-white/60 text-sm">Completed Today</div>
            </div>
            <div class="plan-card rounded-lg p-4 text-center">
                <div class="text-2xl font-bold text-cyber-purple" id="xpToday">-</div>
                <div class="text-white/60 text-sm">XP Today</div>
            </div>
            <div class="plan-card rounded-lg p-4 text-center">
                <div class="text-2xl font-bold text-cyber-red" id="streakDays">-</div>
                <div class="text-white/60 text-sm">Streak Days</div>
            </div>
        </div>

        <!-- Navigation -->
        <div class="flex justify-center gap-4 mt-8">
            <a href="{{ url_for('index') }}" class="bg-black border border-white/30 text-white px-6 py-3 rounded-lg hover:border-blue-500 transition-all duration-300">
                🏠 Dashboard
            </a>
            <a href="{{ url_for('show_quests') }}" class="bg-black border border-white/30 text-white px-6 py-3 rounded-lg hover:border-blue-500 transition-all duration-300">
                ⚔️ Quests
            </a>
            <a href="{{ url_for('character_skills') }}" class="bg-black border border-white/30 text-white px-6 py-3 rounded-lg hover:border-blue-500 transition-all duration-300">
                🌟 Skills
            </a>
        </div>
    </div>

    <script>
        // Load daily stats on page load
        window.addEventListener('load', loadDailyStats);

        async function generatePlan() {
            try {
                showLoading('Generating your strategic plan...');
                const response = await fetch('/api/three-month-plan/generate', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' }
                });
                
                const data = await response.json();
                
                if (data.success) {
                    showNotification('Plan generated successfully!', 'success');
                    setTimeout(() => location.reload(), 1000);
                } else {
                    showNotification('Error: ' + data.error, 'error');
                }
            } catch (error) {
                showNotification('Error generating plan: ' + error.message, 'error');
            }
            hideLoading();
        }

        async function generateDailyQuests() {
            try {
                showLoading('Generating daily quests...');
                const response = await fetch('/api/daily-quests/generate', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' }
                });
                
                const data = await response.json();
                
                if (data.success) {
                    showNotification(`Generated ${data.count} daily quests!`, 'success');
                    loadDailyStats();
                } else {
                    showNotification('Error: ' + data.error, 'error');
                }
            } catch (error) {
                showNotification('Error generating quests: ' + error.message, 'error');
            }
            hideLoading();
        }

        async function sendTestNotification() {
            try {
                const response = await fetch('/api/notification/manual', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ type: 'morning' })
                });
                
                const data = await response.json();
                
                if (data.success) {
                    showNotification('Test notification sent!', 'success');
                } else {
                    showNotification('Error: ' + data.error, 'error');
                }
            } catch (error) {
                showNotification('Error sending notification: ' + error.message, 'error');
            }
        }

        async function loadDailyStats() {
            try {
                const response = await fetch('/api/daily-quests/stats');
                const data = await response.json();
                
                if (data.success) {
                    const stats = data.stats;
                    document.getElementById('dailyQuests').textContent = stats.total_quests;
                    document.getElementById('completedToday').textContent = stats.completed_quests;
                    document.getElementById('xpToday').textContent = stats.xp_earned_today;
                    document.getElementById('streakDays').textContent = '🔥 ' + Math.floor(stats.completion_rate * 10);
                }
            } catch (error) {
                console.error('Error loading daily stats:', error);
            }
        }

        function showNotification(message, type = 'info') {
            // Create notification element
            const notification = document.createElement('div');
            notification.className = `fixed top-4 right-4 z-50 px-6 py-4 rounded-lg text-white font-bold transition-all duration-300 ${
                type === 'success' ? 'bg-cyber-green' : 
                type === 'error' ? 'bg-cyber-red' : 'bg-cyber-blue'
            }`;
            notification.textContent = message;
            
            document.body.appendChild(notification);
            
            // Remove after 3 seconds
            setTimeout(() => {
                notification.style.opacity = '0';
                notification.style.transform = 'translateX(100%)';
                setTimeout(() => notification.remove(), 300);
            }, 3000);
        }

        function showLoading(message) {
            const loading = document.createElement('div');
            loading.id = 'loading';
            loading.className = 'fixed inset-0 bg-black/80 flex items-center justify-center z-50';
            loading.innerHTML = `
                <div class="plan-card rounded-lg p-8 text-center">
                    <div class="animate-spin text-4xl mb-4">⚡</div>
                    <div class="text-xl font-bold text-cyber-blue">${message}</div>
                </div>
            `;
            document.body.appendChild(loading);
        }

        function hideLoading() {
            const loading = document.getElementById('loading');
            if (loading) loading.remove();
        }
    </script>
</body>
</html>